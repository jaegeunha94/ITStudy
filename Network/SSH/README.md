# 프로토콜이란?
디바이스 간에 데이터를 교환하기 위한 통신 규약

우리가 대화하기 위해 사용하는 언어를 프로토콜이라 할 수 있다.  
한국은 KLP ( Korea Language Protocol ) 라고 한다.

http, ftp와 같은 프로토콜은 IETF( Internet Engineering Task Force, 인터넷 기술표준화위원회)에서  
RFC ( Request For Comment)라는 항목으로 번호를 매겨서 작성하고 있다.

[rfc](https://www.ietf.org/rfc)


# FTP 파일 전송의 여러가지 통신규약
## 1. FTP ( File Transfer Protocol ) 
FTP는 File Transfer Protocol로 말 그대로 파일을 전송하는 통신 규약이다.
기본 포트는 21이지만 바꿔서 사용하는 경우도 있다.  
지금은 보안이 안좋아서 실무에서는 사용하지 않다.

FTP는 명령어를 전달하는 21 포트와 데이터를 전달하는 20(혹은 랜덤) 포트가 있다고 기억하면 된다.
데이터를 전달하는 방식에 따라 액티브와 패시브 모드가 있다.

![ftp](./ftp.PNG)

예를 들어 생각해보자면 철수(서버)와 영희(클라이언트)가 있다면  
액티브 모드는 영희(클라)가 철수(서버)에게 번호(포트)를 알려줘서 철수가 전화를 걸어 얘길 하는거고 

패시브 모드는 철수(서버)가 영희(클라)에게 번호(포트)를 알려줘서    
영희가 전화를 걸어 얘길 하는 그림이라고 생각하면 될듯 합니다. 

ftp는 명령어 방식으로 커맨드 창으로도 이용할 수 있고  
여러가지 gui 프로그램으로도 이용이 가능하다.

예를 들어, 윈도우 탐색기, 파일질라, 알ftp 등이 있다.

그래서 21번 포트로 접속이 되더라도 사용 모드에 따라 서버의 20번 포트   
혹은 클라이언트의 방화벽 정책에 따라서 접속만 되고 실제 파일은 받거나 올리지 못하는 일이 발생한다.  
이 경우는 모드를 변경해보거나 방화벽 정책을 확인해보면 된다.


## 2. SFTP(SSH File Transfer Protocol) 시큐어 셀 전송
SFTP는 SSH를 이용한 파일 전송 프로토콜이다.  
FTP 프로토콜이 사용되지 않다.

## 3. FTP over SSH(Secure FTP)
SSH를 이용하여 연결한다음,  
일반 FTP로 접속하는 방식으로 데이터는 암호화되지 않는 방식입니다. 

## 4. FTPS(FTP over SSL)
FTP Secure 또는 FTP-SSL로 알려진 FTPS는 TLS(Transport Layer Security)와  
Secure Sockets Layer (SSL) 암호화 프로토콜이 더해진   
FTP의 파생 프로토콜 입니다.  
SSL 레이어 위에서 FTP를 수행하는 것으로서 command 와 data 모두 암호화 됩니다.


# FTP ( 21 포트 )

# FTPS (SFtp가 아니다)
ftps 는 https 때와 동일한 개념입니다. 인터넷을 검색해보면 맨 TLS/SSL 을 거쳐서 안전한 채널이라고만 나오는 자료가 많은데  
결국 TLS/SSL을 거친다는 의미는 공개키 암호화 방식을 이용하여 통신 라인을 거쳐다는 21번, 20번 포트를 안전하게 암호화한단 말입니다.  
( 거듭 말하지만 포트는 설정에서 변경 가능 )


공개키 암호화 방식은 결국 서버 공개키로 암호화하면 서버가 가진 비공개 개인키로만 풀수 있다.  
라는 대전제로 공개키가 노출되어도 문제가 없기 때문에 할 수 있는 암호화 방식입니다.  
좀 더 쉽게 얘기하자면 서버가 건네주는 보자기(공개키)로 클라이언트가 감싸서 건네주면 그 보자기의 내용물은 서버만 열어볼 수 있다는 논리입니다. 

 

## FTPS 장점
SFTP와 달리 FTPS를 사용하면 사람이 통신을 이해하고 읽을 수 있습니다.  
서버 간 파일 전송 실행을 허용합니다.  
SSL/TLS는 강력한 인증 메커니즘 역할을 하는 X.509 인증서 기능과 함께 제공됩니다.  
여러 인터넷 통신 인프라에 FTP 및 SSL 지원이 내장되어 있습니다.  
 
## FTPS 단점
프로토콜에는 디렉토리 목록에 대한 표준화된 형식이 포함되어 있지 않습니다.  
FTPS는 보조 데이터 채널의 사용을 요구하므로 방화벽 뒤에서 사용이 복잡해집니다.  
프로토콜에는 인코딩 또는 파일 이름 문자 집합에 대한 지침이 없습니다.  
모든 FTP 서버에서 SSL/TLS 지원을 사용할 수 있는 것은 아닙니다.  
프로토콜은 디렉토리 또는 파일 속성을 보호하고 수정하는 표준 방법을 정의하지 않습니다.


# SFtp (포트 22)
sftp는 ssh의 파일 전송 버전이라 생각하면 됩니다. FTP 이름을 달고 있지만 실상은 ssh와 같은 방식을 사용하니   
ssh 에 대해서 알아야겠죠? ssh(Secure SHell) 는 텔넷(telnet)의 보안 버전이죠. 실무에서는 sftp와 ssh만을 이용하고 있네요. 
ssh(sftp)에서 터널링을 하는 방법은 ftps에서의 방식과 상당히 유사합니다. 


SSH는 3개의 프로토콜로 이루어져있죠.이 그림을 알아야 ssh에 대해서 조금은 안다고 얘기할수 있을 거 같습니다.

아래 그림은 첫번째. 전송 프로토콜 부분입니다. 얘도 결국 키를 교환하여 암호화 한다는 데  
ftps와 맥을 같이 하고 있습니다만 위에 신원확인용 스트링 교환이라는 부분이 다르네요. 다른건 비슷한거 같습니다.  
ssh-1은 보안 취약점으로 ssh-2 버전을 이용한다고 합니다. 

![ssh](./ssh.PNG)


기억할 건, SFtp는 ssh 방식을 이용하여 안전하게 암호화된 구간에서 ftp 기능을 이용할 수 있다는 겁니다.

 

## SFtp 장점
SFTP는 하나의 연결만 필요하며 데이터 연결이 필요하지 않습니다.
연결이 안전하게 보호됩니다.
SFTP는 기계가 읽을 수 있고 균일한 디렉토리 목록을 자랑합니다.
프로토콜에서 제공하는 추가 기능에는 파일 잠금, 속성 조작, 권한 작업 및 더 많은 기능이 포함됩니다.


## SFtp 단점
이 프로토콜은 사람이 읽을 때 "있는 그대로" 기록할 수 없음을 의미하는 이진 통신에 관여합니다.
SSH 키의 유효성 검사 및 관리는 더 복잡합니다.
여러 공급업체의 소프트웨어 타이틀 간에 호환성 문제를 일으킬 수 있는 여러 SFTP 구성 "표준"이 있습니다.
프로토콜은 서버 간 복사 외에 재귀 디렉터리에 대한 제거 작업을 제공하지 않습니다.
.NET 및 VCL에는 기본적으로 SSH/SFTP 지원이 포함되어 있지 않습니다.
 

SFTP에서 추가적으로 기억할만한 요소로서 `SFTP는 SSH 기반으로 동작하는 FTP가 아니며  `  
국제 인터넷 표준화 기구(IETF) SECSH 워킹 그룹에 의해 처음부터 설계된 새로운 프로토콜입니다. 

`(SFTP는 SSH 확장 프로토콜입니다. )`


![sftp](./sftp.PNG)



# 참조
[bustar tistory](https://bustar.tistory.com/204)

[nhj12311 tistory](https://nhj12311.tistory.com/76)
